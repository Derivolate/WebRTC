function start(){navigator.getUserMedia({audio:AUDIO,video:VIDEO},function(e){$("#vid0").prop("src",URL.createObjectURL(e)),window.localStream=e},function(e){alert("An error occured! "+e)})}function stopCall(){}function step3(e){window.existingCall&&window.existingCall.close(),e.on("stream",function(e){$("#vid1").prop("src",URL.createObjectURL(e))}),window.existingCall=e,$("#their-id").text(e.peer),e.on("close",stopCall())}var AUDIO=!0,VIDEO=!0,width=200,height=150,vids=4;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var peer=new Peer({key:"wzjo8kfky0qz1tt9"});peer.on("open",function(){$("#my-id").text(peer.id)}),peer.on("call",function(e){e.answer(window.localStream),step3(e)}),peer.on("error",function(e){alert(e.message),step2()}),start(),$(function(){$("#make-call").click(function(){var e=peer.call($("#callto-id").val(),window.localStream);step3(e)}),$("#end-call").click(function(){window.existingCall.close()})});